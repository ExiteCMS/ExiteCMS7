<?php 
require_once dirname(__FILE__)."/../../maincore.php";

// webmaster tool only!
if (!iMEMBER || $userdata['user_id'] != 1) fallback(BASEDIR."index.php");

$addresses = array();

$addresses[] = "benz@cistron.nl";
$addresses[] = "azerty_222222@yahoo.com";
$addresses[] = "gigadreampixels@hotmail.com";
$addresses[] = "comprive@planet.nl";
$addresses[] = "edwinbust01@cs.com";
$addresses[] = "orgasmus4u@gmx.net";
$addresses[] = "aratinga@hetnet.l";
$addresses[] = "e.dijkstra7@chello.nl";
$addresses[] = "info@dragondesignstudio.nl";
$addresses[] = "carlbropt@berahe.info";
$addresses[] = "ruudscuba@wanadoo.nl";
$addresses[] = "siman0@hotmail.com";
$addresses[] = "jvdalen@casema.nl";
$addresses[] = "denis.graulus@pandora.be";
$addresses[] = "mgf@netc.pt";
$addresses[] = "jwgelsing@planet.nl";
$addresses[] = "driveraccount@hotmail.com";
$addresses[] = "gj.lemmers@hccnet.nl";
$addresses[] = "hjm.bosman@chello.nl";
$addresses[] = "frits@hoejenbos.com";
$addresses[] = "remi.jarrige@wanadoo.fr";
$addresses[] = "larissa-amanda@planet.nl";
$addresses[] = "varenx@yahoo.com";
$addresses[] = "info_zenrix@hotmail.com";
$addresses[] = "spj@spj.speedlinq.nl";
$addresses[] = "kodok@tiscali.nl";
$addresses[] = "dd.jv@tiscali.be";
$addresses[] = "gdewilde@home.nl";
$addresses[] = "dreambox-portal@home.nl";
$addresses[] = "thephantomnl@hotmail.com";
$addresses[] = "gvbr@xs4all.nl";
$addresses[] = "jfoe@tempus-fugit.info";
$addresses[] = "laxjeja@gewhiz1.com";
$addresses[] = "aadm4@msn.com";
$addresses[] = "vdg@justopt.info";
$addresses[] = "oyli@foryou74.com";
$addresses[] = "sako1@home.nl";
$addresses[] = "j.linde4@chello.nl";
$addresses[] = "orgbrd@doh75.com";
$addresses[] = "wpefykdk@manus-manum-lavat.info";
$addresses[] = "hdxa@temet-nosce.info";
$addresses[] = "sa9ab0@hotmail.com";
$addresses[] = "ewfwlh@tempori-parce.info";
$addresses[] = "faxuvv@non-olet.info";
$addresses[] = "magneet@tiscali.nl";
$addresses[] = "pypfd@weare94.com";
$addresses[] = "wmmfbu@deus-vult.info";
$addresses[] = "ljfkj@deo-vindice.info";
$addresses[] = "bedo@home.nl";
$addresses[] = "wvanminderhout@home.nl";
$addresses[] = "juggler@sapo.pt";
$addresses[] = "jizbo@hotmail.com";
$addresses[] = "jbhtlqtt@nosce-te-ipsum.info";
$addresses[] = "hebjijhetook@hotmail.com";
$addresses[] = "healthinsurance@ipharmex.info";
$addresses[] = "gold@ipharmex.info";
$addresses[] = "eddie.geerts@hotmail.com";
$addresses[] = "host@phentermine1.info";
$addresses[] = "shyficv@vztl.com";
$addresses[] = "yyddpob@zffk.com";
$addresses[] = "gosotmepos@foteret.info";
$addresses[] = "sorapteki@berahe.info";
$addresses[] = "bruutdream@hotmail.com";
$addresses[] = "guy.orban1@pandora.be";
$addresses[] = "satlooker@hotmail.com";
$addresses[] = "wkotohrof@foteret.info";
$addresses[] = "frankern@hiretin.info";
$addresses[] = "mikebaldree@comcast.net";
$addresses[] = "info@heureka.se";
$addresses[] = "timgrots@hiretin.info";
$addresses[] = "kirbromer@tomaner.info";
$addresses[] = "melfariost@rosledin.info";
$addresses[] = "Garf@tiscali.be";
$addresses[] = "rd151014@scarlet.be";
$addresses[] = "delsma@home.nl";
$addresses[] = "nblamter@refiras.info";
$addresses[] = "johan.deforce@pi.be";
$addresses[] = "clampon14@hotmail.com";
$addresses[] = "staartje@zeelandnet.nl";
$addresses[] = "zsolt.kecskes@hotmail.com";
$addresses[] = "raton_craquero@hotmail.com";
$addresses[] = "h.airco@wanadoo.nl";
$addresses[] = "rene@rrens.demon.nl";
$addresses[] = "ivanderbilt@planet.nl";
$addresses[] = "pputrella@hotmail.com";
$addresses[] = "fox_seuetm@fakemail.dyndns.org";
$addresses[] = "blackrock@hotpop.com";
$addresses[] = "bobvandenberg@hotmail.com";
$addresses[] = "alvaropl@telefonica.net";
$addresses[] = "glen___69@hotmail.com";
$addresses[] = "bernardino@jobedir.com";
$addresses[] = "willem@muldernet.nl";
$addresses[] = "RENE.SLIEPEN@HOTMAIL.COM";
$addresses[] = "tq23@hotmail.com";
$addresses[] = "mail1608179@bupkiss.net";
$addresses[] = "txrx@tm.net.my";
$addresses[] = "tiago@bluewin.ch";
$addresses[] = "tomktx@interia.pl";
$addresses[] = "denmarlycontact@web.de";
$addresses[] = "R.bergsma@oudzuid.amsterdam.nl";
$addresses[] = "erik@afentoe.nl";
$addresses[] = "qvbf@uxwp.com";
$addresses[] = "nikky@alsado.com";
$addresses[] = "wcbrp@vhzn.com";
$addresses[] = "lyynbtc@vfgl.com";
$addresses[] = "dzgvbqm@uixj.com";
$addresses[] = "aljihuv@gkwv.com";
$addresses[] = "lhuaap@qjvd.com";
$addresses[] = "bsdlwxwa@vxnq.com";
$addresses[] = "jqkgzs@ufbh.com";
$addresses[] = "xbaz@rvpy.com";
$addresses[] = "largedyd@vrlq.com";
$addresses[] = "eueoeigx@rhij.com";
$addresses[] = "gksfgd@hoqw.com";
$addresses[] = "ygbcyab@ne-quid-nimis.info";
$addresses[] = "sp69@megapolis.pl";
$addresses[] = "jackd@sathack.com";
$addresses[] = "ldde@qlfg.com";
$addresses[] = "wxqoj@xvnq.com";
$addresses[] = "Jan.Treep@haerst.nl";
$addresses[] = "glueyz@wuqs.com";
$addresses[] = "9netru@alsado.com";
$addresses[] = "tpdsij@vxaz.com";
$addresses[] = "jjhzo@kujd.com";
$addresses[] = "vjxlmxy@nvzv.com";
$addresses[] = "cnxjrtib@zmur.com";
$addresses[] = "rqrid@jvlo.com";
$addresses[] = "jdghow@mtzi.com";
$addresses[] = "hzrmdkgn@lgvb.com";
$addresses[] = "ldro@xgix.com";
$addresses[] = "gdmblhvw@diem-perdidi.info";
$addresses[] = "ilklhoz@oqjs.com";
$addresses[] = "jpvy@yvyl.com";

echo "<table border='1'>\n";
echo "<tr><td>Email address</td>";
echo "<td>UserID</td>";
echo "<td>Username</td>";
echo "<td>Join date</td>";
echo "<td>Last Login</td>";
echo "<td>Posts</td>";
echo "<td>Action</td>";
echo "</tr>\n";

$message = "%s,\n\nDuring a routine and automated check of our member database, we have discovered that your email address is no longer valid (account does not exist, or doesn't accept new messages).\nPlease update your member profile, and enter a valid email address. Member accounts without a valid email address will be deactivated.\n\nThanks for your cooperation,\n[i]pli-images.org Webmaster[/i]";
$nicks = "";

foreach ($addresses as $address) {
	$result2 = dbquery("SELECT * FROM ".$db_prefix."users WHERE user_email = '".$address."'");
	if (dbrows($result2) == 0) {
		echo "<tr><td>", $address, "</td>";
		echo "<td colspan='6'>", "not found in the user database!</td></tr>\n";
	} else {
		$data2 = dbarray($result2);
		echo "<tr><td>", $address, "</td>";
		echo "<td>", $data2['user_id'], "</td>";
		echo "<td>", $data2['user_name'], "</td>";
		echo "<td>", showdate("forumdate", $data2['user_joined']), "</td>";
		echo "<td>", showdate("forumdate", $data2['user_lastvisit']), "</td>";
		$postcount = dbcount("(*)", "posts", "post_author = '".$data2['user_id']."'");
		echo "<td>", $postcount, "</td>";
		if ($data2['user_lastvisit'] >  (time() - 15552000)) {
			$result = dbquery("INSERT INTO ".$db_prefix."messages (message_to, message_from, message_subject, message_message, message_smileys, message_read, message_datestamp, message_folder) 
				VALUES ('".$data2['user_id']."', '1', 'Please update your email address', '".addslashes(sprintf($message, $data2['user_name']))."', 'y', '0', '".time()."', '0')");
			$nicks .= "[b]".$data2['user_name']."[/b] - [url]".$settings['siteurl']."profile.php?lookup=".$data2['user_id']."[/url]\n";
			echo "<td>Sent a PM</td>";
		} else if ($postcount >  0) {
			echo "<td>Has posts, investigate</td>";
		} else {
			$result = dbquery("DELETE FROM ".$db_prefix."users WHERE user_id='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."articles WHERE article_name='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."comments WHERE comment_name='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."messages WHERE message_to='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."messages WHERE message_from='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."news WHERE news_name='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."poll_votes WHERE vote_user='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."ratings WHERE rating_user='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."shoutbox WHERE shout_name='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."threads WHERE thread_author='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."posts WHERE post_author='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."posts_unread WHERE user_id='".$data2['user_id']."'");
			$result = dbquery("DELETE FROM ".$db_prefix."thread_notify WHERE notify_user='".$data2['user_id']."'");
			echo "<td>Deleted the account</td>";
		}
		echo "</tr>\n";
	}
}

if ($nicks != "") {
			$result = dbquery("INSERT INTO ".$db_prefix."messages (message_to, message_from, message_subject, message_message, message_smileys, message_read, message_datestamp, message_folder) 
				VALUES ('1', '1', 'Email address warnings', '".addslashes($nicks)."', 'y', '0', '".time()."', '2')");
}
?>